(self.webpackChunkfreya_admin=self.webpackChunkfreya_admin||[]).push([[947],{65628:function(K,M,e){"use strict";e.r(M),e.d(M,{default:function(){return P}});var $=e(40279),N=e(88591),W=e(66940),q=e(64049),J=e(43334),j=e(28211),k=e(70486),x=e.n(k),Z=e(59301),H=e(60615),D=e(57848),C=e(45103),_=e(81130),B=e(59840),ee=e(7156),O=e(77428),te=e(58408),E=e(36838),Q=e(37793),ae=e(71838),T=e(99128),o=e(36531),re=e(41505),i=e(79538),G=e(28950),b=e.n(G),t=e(37712),z=function(v){return Number(Math.random().toString().substr(3,v)+Date.now()).toString(36)},w=function(v){var y=v.closeModal,Y=v.clickItem,n=Y===void 0?null:Y,U=(0,Z.useState)([]),I=(0,j.Z)(U,2),c=I[0],p=I[1],R=i.Z.useForm(),m=(0,j.Z)(R,1),h=m[0],f={labelCol:{span:6},wrapperCol:{span:16}},F=function(){var s=(0,W.Z)(x().mark(function r(a){var d,l,g,X;return x().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(delete a.avatar,delete a.image,delete a.key,d=c.map(function(A){return A.imgurl}).join(","),l=(0,o.Z)((0,o.Z)({},a),{},{ImgUrl:d}),l.ShowTime=a.ShowTime.format("YYYY-MM-DD HH:mm:ss"),n){u.next=13;break}return u.next=9,(0,C.eC)(l);case 9:g=u.sent,g.code===200&&(y(),T.default.success("\u521B\u5EFA\u6210\u529F")),u.next=18;break;case 13:return l.id=n.id,u.next=16,(0,C.HF)(l);case 16:X=u.sent,X.code===200&&(y(),T.default.success("\u521B\u5EFA\u6210\u529F"));case 18:case"end":return u.stop()}},r)}));return function(a){return s.apply(this,arguments)}}(),V={name:"special_effects",action:"http://dev-chapters-back.stardustgod.com/api/common/uploadSpecialEffects",headers:{Authorization:"Bearer eyJpdiI6ImdkY1JkUHJOWnZGYVF5MkFxMWtpUEE9PSIsInZhbHVlIjoieDJ3SDJYNGphbEljQUxjd1ZHY1RtQ2gzWWRLWTYrbXhnUEdtOEJzK2RcL3M1T25NMWtNMG9vWEc3YzFHTytUeFByXC9aXC9LcjRCOXhTd08yVGFIUkNNbjBzR1Y2Y2pBZ0xqRSt6TVZlVXpMWEN6OTR3OUFzZnFpVjZuM1pNT20rbmJWZVVYYkxQU0VUOXhwbzBNWU5la21zd3RYSHVUa0E2NTdZc0FJelJFMkdnK2trNE8wdWJaSEZncFhId1ZQMnk3dzNrd29VY2V3TlpHZXhuSEVaNU1TSFhXVUJ4dzN6bGs0YUlOMlNRRFpFa2Fyeld2NDBXZWxsM2oyWmpzeDhyY0toWEVQYkVRNFVieGxvMG1COUNwaUhMdnZnXC9uQ1wvUzFjV3ByRElPRFR0QXpyNGpmQzFEUnVLek51VElQRk5XSTF2ZnQ3TXhkY3hmaXAwV053aUFvQ3pEWVhqVmphbEhjSkdkRUE0eHpTVFJqUHIyQVVkbEdPaFhsZzRFS09HbEhGMjN2Ym5ZOWpIWnlEdlB1U0ZpbFp2NElrSG5KTmlHKzU5ZklXMXF3bDRuNkQrRklTRjQxVENUclFOamJNaXVmUXZMTVo5Vkx4VjlaSU9LSE5Wckc4TFUyaXJVM1MreWJGRTlnNUE0NVVCb1duZUxzaHRJR1RZNVB2OWNqZTNtSENjV2h6WWNkUXZIa1huT1lqVkhlSmc9PSIsIm1hYyI6ImJiNWZjYTdlOWI2YWIxZTY0MDJiYjEyYTRhYzY5NGFlYjRhNDJlYWRmNmYxOTIwOTJkNjFiMWIwZmRmZTM4NjUifQ"},onChange:function(r){if(r.file.status!=="uploading",r.file.status==="done"){var a=r.file.response.data;console.log("mp4\xB8data: ",a);var d={id:z(10),imgurl:a.url};p([].concat((0,Q.Z)(c),[d])),T.default.success("".concat(r.file.name," file uploaded successfully"))}else r.file.status==="error"&&T.default.error("".concat(r.file.name," file upload failed."))}};return(0,Z.useEffect)(function(){if(n){var s;console.log("clickItem: ",n);var r=(s=n.img_url)===null||s===void 0?void 0:s.split(",");p(r==null?void 0:r.map(function(d){return{id:z(10),imgurl:d}}));var a={Title:n.title,Content:n.content,CategoryId:n.category_id,ShowTime:b()(n.show_time,"YYYY-MM-DD HH:mm:ss")};h.setFieldsValue(a)}},[]),(0,t.jsx)("div",{children:(0,t.jsxs)(i.Z,(0,o.Z)((0,o.Z)({form:h,initialValues:{CategoryId:6}},f),{},{name:"nest-messages",onFinish:F,children:[(0,t.jsx)(i.Z.Item,{name:"Title",label:"\u6807\u9898",rules:[{required:!0}],children:(0,t.jsx)(E.Z,{})}),(0,t.jsx)(i.Z.Item,{name:"Content",label:"\u5185\u5BB9",rules:[{required:!0}],children:(0,t.jsx)(E.Z.TextArea,{})}),(0,t.jsx)(i.Z.Item,{name:"CategoryId",label:"\u5206\u7C7B",rules:[{required:!0}],children:(0,t.jsx)(E.Z,{})}),(0,t.jsx)(i.Z.Item,{name:"ShowTime",label:"\u5C55\u793A\u65F6\u95F4",rules:[{required:!0}],children:(0,t.jsx)(O.Z,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}})}),(0,t.jsx)(i.Z.Item,{name:"image",label:"\u56FE\u7247",rules:[{required:!1}],children:(0,t.jsx)(B.Z,(0,o.Z)((0,o.Z)({},V),{},{children:(0,t.jsx)(N.Z,{children:"Click to Upload"})}))}),(0,t.jsx)(i.Z.Item,{wrapperCol:(0,o.Z)((0,o.Z)({},f.wrapperCol),{},{offset:8})}),(0,t.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:c==null?void 0:c.map(function(s){return(0,t.jsxs)("div",{style:{position:"relative",width:120,height:120},children:[(0,t.jsx)("div",{onClick:function(){var a=s.id,d=c.reduce(function(l,g){return g.id!==a&&l.push(g),l},[]);p(d)},style:{position:"absolute",right:20,top:-12,fontSize:30,fontWeight:700,color:"red",cursor:"pointer"},children:"X"}),(0,t.jsx)("img",{style:{width:100,height:100},src:"http://cdnoss.stardustgod.com/"+s.imgurl,alt:""})]},s.id)})}),(0,t.jsx)(i.Z.Item,{wrapperCol:(0,o.Z)((0,o.Z)({},f.wrapperCol),{},{offset:8}),children:(0,t.jsx)(N.Z,{type:"primary",htmlType:"submit",children:"Submit"})})]}))})},L=w;function P(){var S=(0,Z.useRef)(),v=(0,Z.useState)(),y=(0,j.Z)(v,2),Y=y[0],n=y[1],U=(0,Z.useState)(),I=(0,j.Z)(U,2),c=I[0],p=I[1],R=[{dataIndex:"id",title:"ID",copyable:!0,ellipsis:!0},{title:"\u6807\u9898",dataIndex:"title",ellipsis:!0},{title:"\u5185\u5BB9",dataIndex:"content",ellipsis:!0},{title:"\u5C55\u793A\u65F6\u95F4",dataIndex:"show_time",sorter:!0,hideInSearch:!0},{title:"\u521B\u5EFA\u65F6\u95F4",key:"created_at",dataIndex:"created_at",sorter:!0,hideInSearch:!0},{title:"\u64CD\u4F5C",valueType:"option",render:function(h,f){return(0,t.jsx)("a",{onClick:function(){p(f),n(!0)},children:"\u4FEE\u6539"})}}];return(0,t.jsxs)("div",{children:[(0,t.jsx)(J.Z,{onCancel:function(){n(!1)},footer:null,visible:Y,destroyOnClose:!0,afterClose:function(){p(void 0)},children:(0,t.jsx)(L,{clickItem:c,closeModal:function(){n(!1),S.current.reload()}})}),(0,t.jsx)(D.ZP,{columns:R,actionRef:S,request:(0,W.Z)(x().mark(function m(){var h,f,F,V,s,r,a=arguments;return x().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return h=a.length>0&&a[0]!==void 0?a[0]:{},f=a.length>1?a[1]:void 0,F=a.length>2?a[2]:void 0,console.log(f,F),V={pageNum:h.current,pageSize:h.pageSize},l.next=7,(0,C.TB)(V);case 7:return s=l.sent,r=s.data.data,console.log("list: ",r),l.abrupt("return",Promise.resolve({data:r,success:!0,total:s.data.total}));case 11:case"end":return l.stop()}},m)})),rowKey:"id",search:!1,pagination:{pageSize:10},dateFormatter:"string",headerTitle:"\u56FE\u7247\u5217\u8868",toolBarRender:function(){return[(0,t.jsx)(N.Z,{onClick:function(){n(!0)},icon:(0,t.jsx)(H.Z,{}),type:"primary",children:"\u65B0\u5EFA"},"button")]}})]})}}}]);
