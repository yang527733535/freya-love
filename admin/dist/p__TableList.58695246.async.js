(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[947],{65628:function(fe,$,e){"use strict";e.r($),e.d($,{default:function(){return ie}});var he=e(40279),R=e(88591),B=e(66940),ve=e(64049),J=e(43334),T=e(28211),Q=e(70486),p=e.n(Q),Z=e(59301),k=e(60615),b=e(57848),H=e(45103),q=e(37793),ge=e(81130),_=e(59840),pe=e(7156),ee=e(77428),ye=e(58408),P=e(36838),xe=e(71838),O=e(99128),d=e(36531),Ze=e(41505),u=e(79538),te=e(7217),V=e.n(te),ae=e(21895),ne=e.n(ae),re=e(28950),se=e.n(re),t=e(37712),W=function(y){return Number(Math.random().toString().substr(3,y)+Date.now()).toString(36)},le=function(y){var j=y.closeModal,M=y.clickItem,l=M===void 0?null:M,w=(0,Z.useState)([]),C=(0,T.Z)(w,2),m=C[0],x=C[1],A=u.Z.useForm(),c=(0,T.Z)(A,1),f=c[0],h={labelCol:{span:6},wrapperCol:{span:16}},I=function(){var r=(0,B.Z)(p().mark(function a(n){var s,i,v,S;return p().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(delete n.avatar,delete n.image,delete n.key,s=m.map(function(G){return G.imgurl}).join(","),i=(0,d.Z)((0,d.Z)({},n),{},{ImgUrl:s}),i.ShowTime=n.ShowTime.format("YYYY-MM-DD HH:mm:ss"),l){o.next=13;break}return o.next=9,(0,H.eC)(i);case 9:v=o.sent,v.code===200&&(j(),O.default.success("\u521B\u5EFA\u6210\u529F")),o.next=18;break;case 13:return i.id=l.id,o.next=16,(0,H.HF)(i);case 16:S=o.sent,S.code===200&&(j(),O.default.success("\u521B\u5EFA\u6210\u529F"));case 18:case"end":return o.stop()}},a)}));return function(n){return r.apply(this,arguments)}}();function Y(r){return g.apply(this,arguments)}function g(){return g=(0,B.Z)(p().mark(function r(a){var n,s,i,v,S,U,o;return p().wrap(function(E){for(;;)switch(E.prev=E.next){case 0:return n=a.file,s=a.headers,i=a.onError,v=a.onProgress,S=a.onSuccess,U=a.withCredentials,o={FileName:n.name},E.next=4,V()({method:"post",url:"http://117.50.173.128:8081/api/upload",data:ne().stringify(o)}).then(function(z){var K=z.data.data.put,je=z.data.data.get,ue=z.data.data.key,X=new FileReader;X.readAsArrayBuffer(n);var L=null;X.onload=function(de){L=de.target.result,console.log("fileData: ",L),console.log("123----imagetoken",K),V().put(K,L,{withCredentials:U,headers:s,onUploadProgress:function(F){var me=F.total,ce=F.loaded;v({percent:Math.round(ce/me*100).toFixed(2)},n)}}).then(function(N){console.log(N),S(N,n);var F={id:W(10),imgurl:ue};console.log(F),x([].concat((0,q.Z)(m),[F]))}).catch(i)}});case 4:case"end":return E.stop()}},r)})),g.apply(this,arguments)}return(0,Z.useEffect)(function(){if(l){var r;console.log("clickItem: ",l);var a=(r=l.img_url)===null||r===void 0?void 0:r.split(",");x(a==null?void 0:a.map(function(s){return{id:W(10),imgurl:s}}));var n={Title:l.title,Content:l.content,CategoryId:l.category_id,ShowTime:se()(l.show_time,"YYYY-MM-DD HH:mm:ss")};f.setFieldsValue(n)}},[]),(0,t.jsx)("div",{children:(0,t.jsxs)(u.Z,(0,d.Z)((0,d.Z)({form:f,initialValues:{CategoryId:6}},h),{},{name:"nest-messages",onFinish:I,children:[(0,t.jsx)(u.Z.Item,{name:"Title",label:"\u6807\u9898",rules:[{required:!0}],children:(0,t.jsx)(P.Z,{})}),(0,t.jsx)(u.Z.Item,{name:"Content",label:"\u5185\u5BB9",rules:[{required:!0}],children:(0,t.jsx)(P.Z.TextArea,{})}),(0,t.jsx)(u.Z.Item,{name:"CategoryId",label:"\u5206\u7C7B",rules:[{required:!0}],children:(0,t.jsx)(P.Z,{})}),(0,t.jsx)(u.Z.Item,{name:"ShowTime",label:"\u5C55\u793A\u65F6\u95F4",rules:[{required:!0}],children:(0,t.jsx)(ee.Z,{showTime:!0,format:"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}})}),(0,t.jsx)(u.Z.Item,{name:"image",label:"\u56FE\u7247",rules:[{required:!1}],children:(0,t.jsx)(_.Z,{headers:{"Content-Type":"image/jpeg"},name:"avatar",className:"avatar-uploader",showUploadList:!1,customRequest:Y,children:(0,t.jsx)(R.Z,{children:"\u4E0A\u4F20"})})}),(0,t.jsx)(u.Z.Item,{wrapperCol:(0,d.Z)((0,d.Z)({},h.wrapperCol),{},{offset:8})}),(0,t.jsx)("div",{style:{display:"flex",flexWrap:"wrap"},children:m==null?void 0:m.map(function(r){return(0,t.jsxs)("div",{style:{position:"relative",width:120,height:120},children:[(0,t.jsx)("div",{onClick:function(){var n=r.id,s=m.reduce(function(i,v){return v.id!==n&&i.push(v),i},[]);x(s)},style:{position:"absolute",right:20,top:-12,fontSize:30,fontWeight:700,color:"red",cursor:"pointer"},children:"X"}),(0,t.jsx)("img",{style:{width:100,height:100},src:"http://myasd.oss-cn-beijing.aliyuncs.com/"+r.imgurl,alt:""})]},r.id)})}),(0,t.jsx)(u.Z.Item,{wrapperCol:(0,d.Z)((0,d.Z)({},h.wrapperCol),{},{offset:8}),children:(0,t.jsx)(R.Z,{type:"primary",htmlType:"submit",children:"Submit"})})]}))})},oe=le;function ie(){var D=(0,Z.useRef)(),y=(0,Z.useState)(),j=(0,T.Z)(y,2),M=j[0],l=j[1],w=(0,Z.useState)(),C=(0,T.Z)(w,2),m=C[0],x=C[1],A=[{dataIndex:"id",title:"ID",copyable:!0,ellipsis:!0},{title:"\u6807\u9898",dataIndex:"title",ellipsis:!0},{title:"\u5185\u5BB9",dataIndex:"content",ellipsis:!0},{title:"\u5C55\u793A\u65F6\u95F4",dataIndex:"show_time",sorter:!0,hideInSearch:!0},{title:"\u521B\u5EFA\u65F6\u95F4",key:"created_at",dataIndex:"created_at",sorter:!0,hideInSearch:!0},{title:"\u64CD\u4F5C",valueType:"option",render:function(f,h){return(0,t.jsx)("a",{onClick:function(){x(h),l(!0)},children:"\u4FEE\u6539"})}}];return(0,t.jsxs)("div",{children:[(0,t.jsx)(J.Z,{onCancel:function(){l(!1)},footer:null,visible:M,destroyOnClose:!0,afterClose:function(){x(void 0)},children:(0,t.jsx)(oe,{clickItem:m,closeModal:function(){l(!1),D.current.reload()}})}),(0,t.jsx)(b.ZP,{columns:A,actionRef:D,request:(0,B.Z)(p().mark(function c(){var f,h,I,Y,g,r,a=arguments;return p().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return f=a.length>0&&a[0]!==void 0?a[0]:{},h=a.length>1?a[1]:void 0,I=a.length>2?a[2]:void 0,console.log(h,I),Y={pageNum:f.current,pageSize:f.pageSize},s.next=7,(0,H.TB)(Y);case 7:return g=s.sent,r=g.data.data,console.log("list: ",r),s.abrupt("return",Promise.resolve({data:r,success:!0,total:g.data.total}));case 11:case"end":return s.stop()}},c)})),rowKey:"id",search:!1,pagination:{pageSize:10},dateFormatter:"string",headerTitle:"\u56FE\u7247\u5217\u8868",toolBarRender:function(){return[(0,t.jsx)(R.Z,{onClick:function(){l(!0)},icon:(0,t.jsx)(k.Z,{}),type:"primary",children:"\u65B0\u5EFA"},"button")]}})]})}}}]);
